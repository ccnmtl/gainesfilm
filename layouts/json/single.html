{{ $images := where .Site.Pages ".Type" "image" }}
{{ $documents := where .Site.Pages ".Type" "document" }}
{{ $videos := where .Site.Pages ".Type" "video" }}
[{{ range $index, $page := $images }}{{ if $index }},{{ end }}
{
  "url": "{{$page.RelPermalink}}",
  "title": "{{$page.Title}}",
  "media": "{{$page.Type}}",
  "year": "{{$page.Params.year}}",
  "copyright": "{{$page.Params.copyright}}",
  "copyright_notes": "{{$page.Params.copyright_notes}}",
  "director": "{{$page.Params.director}}",
  "film_title": "{{$page.Params.film_title}}",
  "image_src": "{{$page.Params.image_src}}",
  "image_url": "{{$page.Params.image_url}}",
  "location": "{{$page.Params.location}}",
  "notes": "{{$page.Params.notes | replaceRE "[\n\r]+" " "}}",
  "physical_description": "{{$page.Params.physical_description}}",
  "repository": "{{$page.Params.repository}}",
  "category": "{{range $page.Params.categories}}{{.}}{{end}}",
  "category_link": "{{range $page.Params.categories}}/categories/{{. | urlize}}/{{end}}",
  "course_link": "{{range $page.Params.courses}}/courses/{{. | urlize}}/{{end}}",
  "course": "{{range $page.Params.courses}}{{.}}{{end}}"
}{{ end }}

{{ range $index, $page := $documents }},
{
  "url": "{{$page.RelPermalink}}",
  "title": "{{$page.Title}}",
  "media": "{{$page.Type}}",
  "year": "{{$page.Params.year}}",
  "copyright": "{{$page.Params.copyright}}",
  "copyright_notes": "{{$page.Params.copyright_notes}}",
  "director": "{{$page.Params.director}}",
  "film_title": "{{$page.Params.film_title}}",
  "image_src": "{{$page.Params.image_src}}",
  "image_url": "{{$page.Params.image_url}}",
  "location": "{{$page.Params.location}}",
  "notes": "{{$page.Params.notes | replaceRE "[\n\r]+" " "}}",
  "physical_description": "{{$page.Params.physical_description}}",
  "repository": "{{$page.Params.repository}}",
  "category": "{{range $page.Params.categories}}{{.}}{{end}}",
  "category_link": "{{range $page.Params.categories}}{{. | urlize}}{{end}}",
  "course_link": "{{range $page.Params.courses}}/courses/{{. | urlize}}/{{end}}",
  "course": "{{range $page.Params.courses}}{{.}}{{end}}"
}{{ end }}

{{ range $index, $page := $videos }},
{
  "url": "{{$page.RelPermalink}}",
  "title": "{{$page.Title}}",
  "media": "{{$page.Type}}",
  "year": "{{$page.Params.year}}",
  "copyright": "{{$page.Params.copyright}}",
  "copyright_notes": "{{$page.Params.copyright_notes}}",
  "director": "{{$page.Params.director}}",
  "film_title": "{{$page.Params.film_title}}",
  "image_src": "{{$page.Params.image_src}}",
  "image_url": "{{$page.Params.image_url}}",
  "location": "{{$page.Params.location}}",
  "notes": "{{$page.Params.notes | replaceRE "[\n\r]+" " "}}",
  "physical_description": "{{$page.Params.physical_description}}",
  "repository": "{{$page.Params.repository}}",
  "category": "{{range $page.Params.categories}}{{.}}{{end}}",
  "category_link": "{{range $page.Params.categories}}{{. | urlize}}{{end}}",
  "course_link": "{{range $page.Params.courses}}/courses/{{. | urlize}}/{{end}}",
  "course": "{{range $page.Params.courses}}{{.}}{{end}}"
}{{ end }}
]
